
<body>
  <style>
	#chatbar{
	height: 40px;
	position: fixed;
	bottom:0%;
	width:100%;
    }
  </style>
  <nav class="navbar navbar-default">
    <div class="container-fluid">
      <div class="navbar-footer">
        <div class="collapse navbar-collapse">
		  <ul class="nav navbar-nav navbar-right">
			<li class ="dropup">
			  <a class="dropdown-toggle" data-toggle="dropdown" href="#"> <span class ="glyphicon glyphicon-user"></span>  Friends</a>
			  <ul class="dropdown-menu" id="friendsMenu">
			  </ul>
			</li>

			<li class="dropup">
			  <a class="dropdown-toggle" data-toggle="dropdown" href="#"> <span class ="glyphicon glyphicon-bell"></span></a>
			  <ul class="dropdown-menu" id="notificationsMenu">
			  </ul>
			</li>
		  </ul>
        </div>
      </div>
  </nav>


	<script type="text/javascript">
	var listOfFriends =
	<?php
	   //pull friends from table
	   include 'opendb.php';
	   $db_socket = initSocket();
	   if(!is_null($db_socket))
	   {
			$query = "SELECT * FROM ".$configValue['DB_FRIENDS_LIST']." WHERE id_A ='".$_SESSION['curr_id']."'";
			//$query = "SELECT * FROM friends_list WHERE id_A = '2'";
			$statement = $db_socket->prepare($query);
			$statement->execute();
			if($statement->rowCount() == 0)
			{
				$ret = array();
				$ret[] = "No Friends";
				echo json_encode($ret);
			}
			else
			{
				//echo 'console.log("found some friends")';
				//$arrayOfColumns = array();

				$arrayOfNames = array();
				$arrayOfColumns = $statement->fetchAll(PDO::FETCH_COLUMN, 1);
				//for each array elemnt in array of Columns add the friend username
				//so do another query
				for($i = 0; $i < count($arrayOfColumns); $i++)
				{
					$nameQuery = "SELECT user FROM ".$configValue['DB_USER_TABLE']." WHERE id='".$arrayOfColumns[$i]."'";
					$nameStatement = $db_socket->prepare($nameQuery);
					$nameStatement->execute();
					$name = $nameStatement->fetchColumn(0);
					$arrayOfNames[] = $name;
	  			}
	  			echo json_encode($arrayOfNames);
	  		}
	  
	  }
	  ?>

	var dropUpMenu = document.getElementById("friendsMenu");
	//pull friends list from database
	for(var i = 0; i < listOfFriends.length; i++)
	{
		var opt = listOfFriends[i];
		var li = document.createElement("li");
		var link = document.createElement("a");
		var text = document.createTextNode(opt);
		link.appendChild(text);
		link.href = "#";
		li.appendChild(link);
		dropUpMenu.appendChild(li);
	}


	var listOfNotifications =
	<?php
		$query = "SELECT * FROM ".$configValue['DB_NOTIFICATIONS_LIST']." WHERE id ='".$_SESSION['curr_id']."'";
		$statement = $db_socket->prepare($query);
	  	$statement->execute();
		if($statement->rowCount() == 0)
		{
			$ret = array();
			$ret[] = 0;
			echo json_encode($ret);
		}
		else
		{
			$ret = array();

			$arrayCols = $statement->fetchAll();

			for($i = 0; $i < count($arrayCols); $i++)
			{
				//0 == friend request
				//1 == message
				//2 == misc
				$noti_type = $arrayCols[$i];
				$ret[] = array();
				$ret[$i][0] = $noti_type[1];
				$ret[$i][1] = $noti_type[3];
			}
			echo json_encode($ret);
	
		}
		?>

	var notificationsMenu = document.getElementById("notificationsMenu");
	if(listOfNotifications[0] == 0)
	{
		//well
		var opt = "No Notifications";
		var li = document.createElement("li");
		var link = document.createElement("a");
		var text = document.createTextNode(opt);
		link.appendChild(text);
		link.href = "#";
		li.appendChild(link);
		notificationsMenu.appendChild(li);
	}
	else
	{
		for(var i = 0; i < listOfNotifications.length; i++)
		{
			var opt = listOfNotifications[i][1];
			var span = document.createElement('span')
			if(listOfNotifications[i][0] == 0)
			{
				span.setAttribute('class', 'glyphicon glyphicon-user');
			}
			else if(listOfNotifications[i][0] == 1)
			{
				span.setAttribute('class', 'glyphicon glyphicon-inbox');
			}
			span.innerHTML="  " + opt;
			var li = document.createElement("li");
			var link = document.createElement("a");
			link.href = "#";
			link.appendChild(span);
			li.appendChild(link);
			notificationsMenu.appendChild(li);			
		}		
	}
	</script>
</body>
